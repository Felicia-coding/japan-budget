<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æœ¬æ—…éŠå¿«é€Ÿè¨˜å¸³</title>
    <style>
        /* åŸºç¤æ¨£å¼ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
        }

        /* æ¨™é¡Œ */
        h1 {
            color: #d32f2f; /* é¡ä¼¼æ—¥æœ¬åœ‹æ——çš„ç´…è‰² */
            text-align: center;
            margin-bottom: 30px;
        }

        /* è¼¸å…¥å€å¡Šæ¨£å¼ */
        #input-area {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        /* è¼¸å…¥æ¡†æ¨£å¼ */
        #expense-input {
            width: calc(100% - 22px);
            padding: 15px;
            margin-bottom: 10px;
            border: 2px solid #ccc;
            border-radius: 8px;
            font-size: 1.2em;
            box-sizing: border-box; /* ç¢ºä¿ padding ä¸æœƒå¢åŠ æ•´é«”å¯¬åº¦ */
        }

        #expense-input::placeholder {
            color: #aaa;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        button {
            width: 100%;
            padding: 15px;
            background-color: #4CAF50; /* ç¶ è‰²ï¼Œè¡¨ç¤ºç¢ºèª */
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-weight: bold;
        }

        button:hover {
            background-color: #45a049;
        }

        /* ç¸½é‡‘é¡é¡¯ç¤ºå€ */
        #summary-area {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #ffeb3b; /* é†’ç›®çš„é»ƒè‰² */
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        #total-amount {
            font-size: 2.5em;
            font-weight: bold;
            color: #d32f2f;
        }

        /* æ­·å²è¨˜éŒ„å€ */
        #history-area {
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-top: 0;
        }

        /* æ—¥æœŸåˆ†çµ„æ¨™é¡Œæ¨£å¼ */
        .date-group {
            margin-top: 20px;
            margin-bottom: 10px;
            padding: 8px 10px;
            background-color: #e0f7fa; /* æ·ºè—è‰²èƒŒæ™¯ */
            color: #00796b; /* æ·±è—ç¶ è‰²æ–‡å­— */
            font-weight: bold;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #expense-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #expense-list li {
            padding: 12px 0;
            border-bottom: 1px dashed #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
        }
        #expense-list li:last-child {
            border-bottom: none;
        }

        .item-description {
            flex-grow: 1;
            padding-right: 10px;
            color: #555;
        }

        .item-amount {
            font-weight: bold;
            color: #d32f2f;
            white-space: nowrap; /* é˜²æ­¢é‡‘é¡æ›è¡Œ */
        }

        .delete-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 1em;
            padding: 0 5px;
            margin-left: 10px;
            transition: color 0.2s;
            width: auto; /* è¦†è“‹ button çš„ 100% å¯¬åº¦ */
        }

        .delete-btn:hover {
            color: #d32f2f;
        }

        /* æ¸…é™¤æŒ‰éˆ• */
        #clear-btn {
            margin-top: 20px;
            background-color: #9e9e9e; /* ç°è‰² */
        }

        #clear-btn:hover {
            background-color: #757575;
        }

    </style>
</head>
<body>

    <h1>ğŸ‡¯ğŸ‡µ æ—¥æœ¬æ—…éŠå¿«é€Ÿè¨˜å¸³ ğŸ’¸</h1>

    <div id="summary-area">
        <p style="margin: 0; font-size: 1.2em; color: #555;">ç¸½æ”¯å‡ºåˆè¨ˆ</p>
        <div id="total-amount">Â¥ 0</div>
    </div>

    <div id="input-area">
        <input type="text" id="expense-input" placeholder="ç¯„ä¾‹: 1500 æ™šé¤ or 280 æ°´" autofocus>
        <button onclick="addExpense()">+ è¨˜éŒ„é€™ç­†æ”¯å‡º</button>
    </div>

    <div id="history-area">
        <h2>ğŸ§¾ æ”¯å‡ºæ­·å²è¨˜éŒ„</h2>
        <div id="expense-list-container">
            </div>
        <button id="clear-btn" onclick="clearAllData()">æ¸…ç©ºæ‰€æœ‰è¨˜éŒ„</button>
    </div>

    <script>
        const STORAGE_KEY = 'japan_trip_expenses';
        const expenseInput = document.getElementById('expense-input');
        const expenseListContainer = document.getElementById('expense-list-container');
        const totalAmountDisplay = document.getElementById('total-amount');
        let expenses = [];

        // --- å·¥å…·å‡½æ•¸ï¼šæ ¼å¼åŒ–æ—¥æœŸ ---
        function formatDate(date) {
            const d = new Date(date);
            const year = d.getFullYear();
            // æœˆä»½å’Œæ—¥æœŸç¢ºä¿æ˜¯å…©ä½æ•¸
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}/${month}/${day}`;
        }

        // --- å·¥å…·å‡½æ•¸ï¼šç²å–ä»Šå¤©çš„æ—¥æœŸå­—ç¬¦ä¸² ---
        function getTodayDateString() {
            return formatDate(new Date());
        }

        // --- åˆå§‹åŒ–å’Œè¼‰å…¥æ•¸æ“š ---
        function init() {
            // å¾æœ¬åœ°å„²å­˜è¼‰å…¥æ•¸æ“š
            const storedExpenses = localStorage.getItem(STORAGE_KEY);
            if (storedExpenses) {
                expenses = JSON.parse(storedExpenses);
            }
            renderExpenses();
            calculateTotal();
            // è¨­å®š Enter éµæäº¤
            expenseInput.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    addExpense();
                }
            });
        }

        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šæ–°å¢æ”¯å‡º ---
        function addExpense() {
            const input = expenseInput.value.trim();
            if (!input) {
                alert('è«‹è¼¸å…¥é‡‘é¡å’Œå“é …ï¼');
                return;
            }

            // ä½¿ç”¨æ­£å‰‡è¡¨é”å¼å°‹æ‰¾è¼¸å…¥é–‹é ­çš„æ•¸å­—ï¼ˆé‡‘é¡ï¼‰
            // åŒ¹é…æ ¼å¼: 1500 æ™šé¤ æˆ– 280 æ°´
            const match = input.match(/^(\d+[\d\.]*)\s*(.*)/);

            let amount = 0;
            let description = input;

            if (match) {
                // match[1] æ˜¯é‡‘é¡ (ä¾‹å¦‚: 1500 æˆ– 280.5)
                // match[2] æ˜¯å“é … (ä¾‹å¦‚: æ™šé¤ æˆ– æ°´)
                amount = parseFloat(match[1]);
                description = match[2] || 'æœªèªªæ˜å“é …'; // å¦‚æœæ²’æœ‰å“é …ï¼Œå‰‡ä½¿ç”¨é è¨­
            } else {
                // å¦‚æœæ²’æœ‰æ•¸å­—é–‹é ­ï¼Œå¯èƒ½åªæ˜¯è¼¸å…¥äº†å“é …ï¼Œé‡‘é¡è¨­ç‚º 0
                alert('è¼¸å…¥æ ¼å¼å»ºè­°ç‚º: é‡‘é¡ å“é … (ä¾‹å¦‚: 1500 æ™šé¤)');
                return;
            }

            if (isNaN(amount) || amount <= 0) {
                 alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„é‡‘é¡ï¼');
                 return;
            }


            const newExpense = {
                id: Date.now(), // ä½¿ç”¨æ™‚é–“æˆ³ä½œç‚ºå”¯ä¸€ID
                amount: amount,
                description: description.trim(),
                date: getTodayDateString() // æ–°å¢æ—¥æœŸè¨˜éŒ„
            };

            expenses.unshift(newExpense); // æ–°å¢åˆ°åˆ—è¡¨çš„æœ€å‰é¢
            saveAndRefresh();

            expenseInput.value = ''; // æ¸…ç©ºè¼¸å…¥æ¡†
            expenseInput.focus(); // è®“ç„¦é»åœç•™åœ¨è¼¸å…¥æ¡†ï¼Œæ–¹ä¾¿å¿«é€Ÿè¼¸å…¥ä¸‹ä¸€ç­†
        }

        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šåˆªé™¤å–®ç­†æ”¯å‡º ---
        function deleteExpense(id) {
            expenses = expenses.filter(expense => expense.id !== id);
            saveAndRefresh();
        }

        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šæ¸…ç©ºæ‰€æœ‰æ•¸æ“š ---
        function clearAllData() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è¨˜å¸³è¨˜éŒ„å—ï¼Ÿé€™å€‹æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                expenses = [];
                saveAndRefresh();
            }
        }

        // --- æ•¸æ“šè™•ç†ï¼šå„²å­˜å’Œåˆ·æ–° ---
        function saveAndRefresh() {
            // å„²å­˜åˆ°ç€è¦½å™¨çš„æœ¬åœ°å„²å­˜
            localStorage.setItem(STORAGE_KEY, JSON.stringify(expenses));
            renderExpenses();
            calculateTotal();
        }

        // --- ç•«é¢æ›´æ–°ï¼šè¨ˆç®—ç¸½é¡ ---
        function calculateTotal() {
            const total = expenses.reduce((sum, expense) => sum + expense.amount, 0);
            // æ ¼å¼åŒ–æ•¸å­—ï¼ŒåŠ ä¸Šé€—è™Ÿ
            totalAmountDisplay.textContent = 'Â¥ ' + total.toLocaleString('ja-JP', { maximumFractionDigits: 0 });
        }

        // --- ç•«é¢æ›´æ–°ï¼šæ¸²æŸ“åˆ—è¡¨ (æ–°å¢æ—¥æœŸåˆ†çµ„é‚è¼¯) ---
        function renderExpenses() {
            expenseListContainer.innerHTML = ''; // æ¸…ç©ºç¾æœ‰åˆ—è¡¨

            if (expenses.length === 0) {
                expenseListContainer.innerHTML = '<p style="text-align: center; color: #999;">ç›®å‰æ²’æœ‰è¨˜éŒ„ï¼Œå¿«è¼¸å…¥ç¬¬ä¸€ç­†æ”¯å‡ºå§ï¼</p>';
                return;
            }

            // 1. æŒ‰æ—¥æœŸåˆ†çµ„
            const groupedExpenses = expenses.reduce((groups, expense) => {
                const date = expense.date;
                if (!groups[date]) {
                    groups[date] = [];
                }
                groups[date].push(expense);
                return groups;
            }, {});

            // 2. ç²å–æ—¥æœŸéµä¸¦æ’åº (ç¢ºä¿æ—¥æœŸæ–°çš„åœ¨å‰é¢)
            const sortedDates = Object.keys(groupedExpenses).sort().reverse();


            sortedDates.forEach(date => {
                const dailyExpenses = groupedExpenses[date];

                // è¨ˆç®—ç•¶æ—¥ç¸½æ”¯å‡º
                const dailyTotal = dailyExpenses.reduce((sum, expense) => sum + expense.amount, 0);
                const dailyTotalFormatted = dailyTotal.toLocaleString('ja-JP', { maximumFractionDigits: 0 });

                // å‰µå»ºæ—¥æœŸåˆ†çµ„æ¨™é¡Œ
                const dateGroupDiv = document.createElement('div');
                dateGroupDiv.className = 'date-group';
                dateGroupDiv.innerHTML = `<span>${date}</span> <span>ç•¶æ—¥åˆè¨ˆ: Â¥ ${dailyTotalFormatted}</span>`;
                expenseListContainer.appendChild(dateGroupDiv);

                // å‰µå»ºæ”¯å‡ºåˆ—è¡¨
                const ul = document.createElement('ul');
                ul.className = 'expense-list';

                dailyExpenses.forEach(expense => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span class="item-description">${expense.description}</span>
                        <span class="item-amount">Â¥ ${expense.amount.toLocaleString('ja-JP', { maximumFractionDigits: 0 })}</span>
                        <button class="delete-btn" onclick="deleteExpense(${expense.id})">x</button>
                    `;
                    ul.appendChild(li);
                });
                expenseListContainer.appendChild(ul); // å°‡ ul æ·»åŠ åˆ°å®¹å™¨ä¸­
            });
        }
        
        // **!!! ç¨‹å¼ç¢¼çš„çµå°¾é—œéµï¼šç¢ºä¿å‘¼å« init() å‡½æ•¸ !!!**
        window.onload = init; // åœ¨ç¶²é è¼‰å…¥å®Œæˆå¾Œï¼ŒåŸ·è¡Œåˆå§‹åŒ–å‡½æ•¸
    </script>
</body>
</html>
