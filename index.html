<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æœ¬æ—…éŠå¿«é€Ÿè¨˜å¸³</title>

    <link rel="icon" href="icon.png">
    
    <style>
        /* åŸºç¤æ¨£å¼ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
        }

        h1 {
            color: #d32f2f; 
            text-align: center;
            margin-bottom: 30px;
        }

        /* è¼¸å…¥å€å¡Šæ¨£å¼ */
        #input-area {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        /* è¼¸å…¥å€å¡Šåˆ†çµ„æ¨™é¡Œ */
        h3 {
            margin-top: 0; 
            margin-bottom: 15px; 
            color: #444;
            padding-bottom: 5px;
            border-bottom: 1px dashed #ddd;
        }

        /* è¼¸å…¥æ¡†å’Œé¸å–®æ¨£å¼ */
        input[type="text"], select {
            width: calc(100% - 22px);
            padding: 15px;
            margin-bottom: 10px;
            border: 2px solid #ccc;
            border-radius: 8px;
            font-size: 1.2em;
            box-sizing: border-box; 
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        button:not(#export-btn, .delete-btn) {
            width: 100%;
            padding: 15px;
            background-color: #4CAF50; 
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-weight: bold;
            margin-bottom: 10px;
            margin-top: 10px; 
        }
        
        button:hover:not(#export-btn, .delete-btn) {
            background-color: #45a049;
        }
        
        /* ç¸½é‡‘é¡é¡¯ç¤ºå€ */
        #summary-area {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #ffd400; 
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        #total-jpy {
            font-size: 2.0em; 
            font-weight: bold;
            color: #d32f2f;
            margin-bottom: 15px;
            display: block;
        }
        #total-twd {
            font-size: 2.0em; 
            font-weight: bold;
            color: #008080; 
            display: block;
        }
        #summary-area p {
            font-size: 1.1em; 
            margin: 5px 0 0 !important;
            color: #555;
            display: block;
        }
        
        /* æ­·å²è¨˜éŒ„å€å¡Šæ¨™é¡Œ */
        #history-header {
            display: flex;
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 10px;
        }

        /* åˆ—è¡¨æ¨£å¼ */
        .expense-list-section h4 {
            margin-top: 25px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            color: #333;
        }
        .twd-in-list {
            font-size: 0.9em;
            color: #008080;
            margin-left: 8px;
            font-style: italic;
        }
        .date-group {
            margin-top: 20px;
            margin-bottom: 10px;
            padding: 8px 10px;
            font-weight: bold;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #jpy-cash-list-container .date-group {
            background-color: #fbe4e4; 
            color: #d32f2f; 
        }
        #jpy-card-list-container .date-group {
            background-color: #fff3e0; 
            color: #ff9800; 
        }
        .card-total-summary {
            padding: 10px;
            background: #e3f2fd; 
            border: 1px solid #bbdefb;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        /* å„å¡åˆ¥ç¸½è¨ˆå°é½Šä¿®æ­£ */
        .card-summary-item {
            display: grid; 
            grid-template-columns: 1fr 100px 100px; 
            gap: 10px; 
            padding: 4px 0;
            border-bottom: 1px dotted #a3a3a3;
            align-items: center;
        }
        .card-summary-item:last-child {
             border-bottom: none;
        }

        .summary-card-name {
            text-align: left; 
        }
        .summary-amount {
            text-align: right; 
            white-space: nowrap; 
        }
        .card-summary-item[style*="font-weight: bold;"] {
            grid-template-columns: 1fr 100px 100px;
        }


        .expense-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .expense-list li {
            padding: 12px 0;
            border-bottom: 1px dashed #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
        }
        .item-description {
            flex-grow: 1;
            padding-right: 10px;
            color: #555;
        }
        .card-name-in-list {
            font-size: 0.8em; 
            color: #888;
            margin-left: 8px; 
            font-style: italic;
        }
        .item-amount {
            font-weight: bold;
            white-space: nowrap; 
            color: #d32f2f;
        }
        .delete-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 1em;
            padding: 0 5px;
            margin-left: 10px;
            width: auto; 
        }
        .delete-btn:hover {
            color: #d32f2f;
        }
        #clear-btn {
            margin-top: 20px;
            background-color: #9e9e9e !important;
        }
        #clear-btn:hover {
            background-color: #757575;
        }
    </style>
</head>
<body>

    <h1>ğŸ‡¯ğŸ‡µ æ—¥æœ¬æ—…éŠå¿«é€Ÿè¨˜å¸³ ğŸ’¸</h1>

    <div id="summary-area">
        <p>æ—¥å¹£ç¸½æ”¯å‡ºåˆè¨ˆ</p>
        <div id="total-jpy">Â¥ 0</div>
        <p>å°å¹£ç¸½æ”¯å‡ºåˆè¨ˆ</p>
        <div id="total-twd">NT$ 0</div>
    </div>

    <div id="input-area">
        
        <h3>ğŸ“ æ—¥å¹£/å°å¹£æ”¯å‡º</h3>
        
        <input type="text" id="jpy-amount-input" placeholder="æ—¥å¹£é‡‘é¡: 1000 é–€ç¥¨" autofocus>
        
        <input type="text" id="twd-card-input" placeholder="å°å¹£é‡‘é¡ (é¸å¡«): 1080">
        
        <select id="twd-card-select">
            </select>
        
        <button onclick="addExpense()">+ è¨˜éŒ„æ”¯å‡º</button>
    </div>

    <div id="history-area">
        <div id="history-header">
            <h2>ğŸ§¾ æ”¯å‡ºæ­·å²è¨˜éŒ„</h2>
            <button id="export-btn" onclick="exportToCsv()">åŒ¯å‡º Excel</button>
        </div>
        
        <div id="jpy-cash-list-container" class="expense-list-section"></div>
        
        <div id="jpy-card-list-container" class="expense-list-section"></div>

        <button id="clear-btn" onclick="clearAllData()">æ¸…ç©ºæ‰€æœ‰è¨˜éŒ„</button>
    </div>

    <script>
        const STORAGE_KEY = 'japan_trip'; 
        
        // 1. DOM å…ƒç´ 
        const jpyAmountInput = document.getElementById('jpy-amount-input');
        const twdCardInput = document.getElementById('twd-card-input');
        const twdCardSelect = document.getElementById('twd-card-select');

        // 2. DOM å…ƒç´  - é¡¯ç¤º
        const totalJpyDisplay = document.getElementById('total-jpy'); 
        const totalTwdDisplay = document.getElementById('total-twd'); 
        
        const jpyCashListContainer = document.getElementById('jpy-cash-list-container');
        const jpyCardListContainer = document.getElementById('jpy-card-list-container');
        
        let expenses = [];

        // å¡åˆ¥é¸é …å®šç¾© (é›†ä¸­ç®¡ç†)
        const cardOptions = [
            { value: "è¯é‚¦å‰é¶´å¡", text: "è¯é‚¦å‰é¶´å¡ (20è¬å††)" },
            { value: "ç‰å±±ç†Šæœ¬ç†Šå¡", text: "ç‰å±±ç†Šæœ¬ç†Šå¡ (10è¬å††)" },
            { value: "ç‰å±±Unicardå¡", text: "ç‰å±±Unicardå¡ (71è¬å††)" },
            { value: "æ°¸è±å¹£å€å¡", text: "æ°¸è±å¹£å€å¡ (10è¬å††)" },
            { value: "åœ‹æ³°CUBEå¡", text: "åœ‹æ³°CUBEå¡ (å¤§ä¸¸å¤©ç¥)" },
        ];
        
        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šåˆå§‹åŒ–å¡åˆ¥é¸å–® ---
        function initCardSelects() {
            const defaultOption = '<option value="">-- å¡åˆ¥ / æœ€ä½³ä¸Šé™ --</option>';
            const optionsHtml = cardOptions.map(o => `<option value="${o.value}">${o.text}</option>`).join('');
            
            twdCardSelect.innerHTML = defaultOption + optionsHtml;
        }

        // --- å·¥å…·å‡½æ•¸ï¼šæ ¼å¼åŒ–æ—¥æœŸ / è§£æè¼¸å…¥ (ä¿æŒä¸è®Š) ---
        function formatDate(date) {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}/${month}/${day}`;
        }

        function getTodayDateString() {
            return formatDate(new Date());
        }

        function parseExpenseInput(inputText, currency) {
            const match = inputText.match(/^(\d+[\d\.]*)\s*(.*)/);
            let amount = 0;
            let description = '';

            if (match) {
                amount = parseFloat(match[1]);
                description = match[2] ? match[2].trim() : `${currency}æ”¯å‡º`;
            }

            if (isNaN(amount) || amount < 0) {
                return { error: `è«‹è¼¸å…¥æœ‰æ•ˆçš„${currency}é‡‘é¡ï¼` };
            }
            
            return { amount, description: description.trim() };
        }

        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šæ–°å¢æ”¯å‡º (å–®ä¸€å‡½æ•¸ï¼ŒåŒ…å«é‚è¼¯åˆ¤æ–·) ---
        function addExpense() {
            let amountJPY = 0;
            let amountTWD = 0;
            let description = '';
            let cardUsed = ''; 
            let type = '';
            let success = false;

            const jpyText = jpyAmountInput.value.trim();
            const twdText = twdCardInput.value.trim();
            cardUsed = twdCardSelect.value;
            
            // åˆ¤æ–·é‚è¼¯
            if (twdText) {
                // æ¨¡å¼ 1: åˆ·å¡ (å°å¹£æœ‰å€¼)
                type = 'CARD_JPY';
                
                if (!jpyText || !cardUsed) {
                    return alert('è«‹è¼¸å…¥æ—¥å¹£é‡‘é¡å’Œå¡åˆ¥ï¼');
                }

                const jpyResult = parseExpenseInput(jpyText, 'æ—¥å¹£åˆ·å¡');
                const twdResult = parseExpenseInput(twdText, 'å°å¹£å…¥å¸³');

                if (jpyResult.error || twdResult.error) {
                    return alert(jpyResult.error || twdResult.error);
                }

                amountJPY = jpyResult.amount;
                amountTWD = twdResult.amount;
                description = jpyResult.description; 
                success = true;
                
            } else if (jpyText) {
                // æ¨¡å¼ 2: ç¾é‡‘ (å°å¹£ç„¡å€¼ï¼Œæ—¥å¹£æœ‰å€¼)
                type = 'CASH_JPY';
                
                const result = parseExpenseInput(jpyText, 'æ—¥å¹£ç¾é‡‘');
                if (result.error) return alert(result.error);
                
                amountJPY = result.amount;
                description = result.description;
                cardUsed = 'æ—¥å¹£ç¾é‡‘'; // è‡ªå‹•å¡«å…¥
                amountTWD = 0;
                success = true;
                
            } else {
                // æ¨¡å¼ 3: éƒ½æ²’è¼¸å…¥
                return alert('è«‹è‡³å°‘è¼¸å…¥æ—¥å¹£é‡‘é¡ (å«æè¿°)ï¼');
            }

            if (success) {
                const newExpense = {
                    id: Date.now(),
                    jpy_amount: amountJPY,
                    twd_amount: amountTWD,
                    description: description, 
                    date: getTodayDateString(),
                    card_used: cardUsed,
                    type: type 
                };
                expenses.unshift(newExpense);
                
                // æ¸…ç©ºæ¬„ä½
                jpyAmountInput.value = ''; 
                twdCardInput.value = '';
                twdCardSelect.value = '';
                
                saveAndRefresh();
                jpyAmountInput.focus(); 
            }
        }

        // --- å…¶ä»–å‡½æ•¸ (ä¿ç•™ä¸è®Š) ---
        
        function deleteExpense(id) {
            expenses = expenses.filter(expense => expense.id !== id);
            saveAndRefresh();
        }

        function clearAllData() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è¨˜å¸³è¨˜éŒ„å—ï¼Ÿé€™å€‹æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                expenses = [];
                saveAndRefresh();
            }
        }
        
        function calculateTotal() {
            const totalJpy = expenses.reduce((sum, expense) => sum + expense.jpy_amount, 0);
            // åªæœ‰åˆ·å¡æ¨¡å¼çš„ TWD æ‰æœƒè¨ˆå…¥ç¸½å°å¹£
            const totalTwd = expenses.reduce((sum, expense) => sum + expense.twd_amount, 0); 

            totalJpyDisplay.textContent = 'Â¥ ' + totalJpy.toLocaleString('ja-JP', { maximumFractionDigits: 0 });
            totalTwdDisplay.textContent = 'NT$ ' + totalTwd.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        }
        
        function calculateCardTotals() {
            const cardExpenses = expenses.filter(e => e.type === 'CARD_JPY');
            
            return cardExpenses.reduce((totals, expense) => {
                const card = expense.card_used || 'æœªçŸ¥å¡åˆ¥';
                if (!totals[card]) {
                    totals[card] = { jpy: 0, twd: 0 };
                }
                totals[card].jpy += expense.jpy_amount || 0;
                totals[card].twd += expense.twd_amount || 0;
                return totals;
            }, {});
        }

        // *** ä¿®æ­£å¾Œçš„åŒ¯å‡ºå‡½æ•¸ï¼šå·²ç§»é™¤ã€Œé¡å‹ã€æ¬„ä½ ***
        function exportToCsv() {
             if (expenses.length === 0) {
                alert('æ²’æœ‰ä»»ä½•æ”¯å‡ºè¨˜éŒ„å¯ä»¥åŒ¯å‡ºï¼');
                return;
            }

            let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; 
            
            // 1. åŒ¯å‡ºæ”¯å‡ºè¨˜éŒ„æ¸…å–® (æ˜ç´°)
            csvContent += "æ—¥æœŸ,èªªæ˜,æ—¥å¹£é‡‘é¡(Â¥),å°å¹£é‡‘é¡(NT$),ä»˜æ¬¾å¡åˆ¥\n"; 

            expenses.forEach(expense => {
                const descriptionSafe = expense.description.replace(/,/g, ';'); 
                const jpy = expense.jpy_amount.toFixed(0); 
                const twd = expense.twd_amount.toFixed(0); 
                const card = expense.card_used || ''; 
                
                csvContent += `${expense.date},${descriptionSafe},${jpy},${twd},${card}\n`; 
            });

            // 2. æ–°å¢å¡åˆ¥ç¸½è¨ˆå€å¡Š (JPY + TWD)
            const cardTotals = calculateCardTotals();
            const totalTwdForCard = expenses.filter(e => e.type === 'CARD_JPY').reduce((sum, expense) => sum + expense.twd_amount, 0);
            const totalJpyForCard = expenses.filter(e => e.type === 'CARD_JPY').reduce((sum, expense) => sum + expense.jpy_amount, 0);


            csvContent += "\n\n"; 
            csvContent += "æ—¥å¹£åˆ·å¡ç¸½çµ\n"; 
            csvContent += "å¡åˆ¥,æ—¥å¹£ç¸½é‡‘é¡(Â¥),å°å¹£ç¸½é‡‘é¡(NT$)\n";
            
            Object.keys(cardTotals).sort().forEach(card => {
                const jpyAmount = cardTotals[card].jpy.toFixed(0);
                const twdAmount = cardTotals[card].twd.toFixed(0);
                csvContent += `${card},${jpyAmount},${twdAmount}\n`;
            });

            csvContent += `ç¸½è¨ˆ,${totalJpyForCard.toFixed(0)},${totalTwdForCard.toFixed(0)}\n`;


            // 3. åŸ·è¡Œä¸‹è¼‰
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            
            const filename = `japan_budget_${new Date().toLocaleDateString('zh-TW').replace(/\//g, '-')}.csv`;
            link.setAttribute("download", filename);
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // *** ä¿®æ­£å¾Œçš„æ¸²æŸ“å‡½æ•¸ï¼šå¢åŠ å°é½Šç”¨çš„ class ***
        function renderCardTotalsSummary(cardTotals) {
            let html = '<div class="card-total-summary"><strong>å„å¡åˆ¥ç¸½è¨ˆ</strong><br>';
            
            const totalJpyForCard = Object.values(cardTotals).reduce((sum, item) => sum + item.jpy, 0);
            const totalTwdForCard = Object.values(cardTotals).reduce((sum, item) => sum + item.twd, 0);

            // é¡¯ç¤ºæ¯å¼µå¡çš„ JPY å’Œ TWD ç¸½é¡
            Object.keys(cardTotals).sort().forEach(card => {
                const totals = cardTotals[card];
                const jpyFormatted = totals.jpy.toLocaleString('ja-JP', { maximumFractionDigits: 0 });
                const twdFormatted = totals.twd.toLocaleString('zh-TW', { maximumFractionDigits: 0 });

                html += `
                    <div class="card-summary-item">
                        <span class="summary-card-name">${card}:</span>
                        <span class="summary-amount" style="color: #d32f2f;">Â¥ ${jpyFormatted}</span>
                        <span class="summary-amount" style="color: #008080;">NT$ ${twdFormatted}</span>
                    </div>
                `;
            });
            
            // é¡¯ç¤ºåˆ·å¡ç¸½è¨ˆ
            html += `
                <div class="card-summary-item" style="font-weight: bold; margin-top: 5px; border-top: 2px solid #bbdefb; padding-top: 5px;">
                    <span class="summary-card-name">åˆ·å¡ç¸½æ”¯å‡º:</span>
                    <span class="summary-amount" style="color: #d32f2f;">Â¥ ${totalJpyForCard.toLocaleString('ja-JP', { maximumFractionDigits: 0 })}</span>
                    <span class="summary-amount" style="color: #008080;">NT$ ${totalTwdForCard.toLocaleString('zh-TW', { maximumFractionDigits: 0 })}</span>
                </div>
            `;
            
            html += '</div>';
            return html;
        }

        function renderExpenses() {
            jpyCashListContainer.innerHTML = '';
            jpyCardListContainer.innerHTML = '';

            if (expenses.length === 0) {
                jpyCashListContainer.innerHTML = '<h4>ğŸ’µ æ—¥å¹£ç¾é‡‘æ”¯å‡º (Â¥)</h4><p style="text-align: center; color: #999;">ç›®å‰æ²’æœ‰è¨˜éŒ„ã€‚</p>';
                jpyCardListContainer.innerHTML = '<h4>ğŸ’³ æ—¥å¹£åˆ·å¡æ”¯å‡º (Â¥/NT$)</h4><p style="text-align: center; color: #999;">ç›®å‰æ²’æœ‰è¨˜éŒ„ã€‚</p>';
                return;
            }

            const jpyCashList = expenses.filter(e => e.type === 'CASH_JPY');
            const jpyCardList = expenses.filter(e => e.type === 'CARD_JPY');
            
            jpyCashListContainer.innerHTML += `<h4>ğŸ’µ æ—¥å¹£ç¾é‡‘æ”¯å‡º (Â¥)</h4>`;
            renderList(jpyCashListContainer, jpyCashList, 'CASH_JPY');

            jpyCardListContainer.innerHTML += `<h4>ğŸ’³ æ—¥å¹£åˆ·å¡æ”¯å‡º (Â¥/NT$)</h4>`;
            
            if (jpyCardList.length > 0) {
                jpyCardListContainer.innerHTML += renderCardTotalsSummary(calculateCardTotals());
            }
            
            renderList(jpyCardListContainer, jpyCardList, 'CARD_JPY');
            
        }
        
        function renderList(container, list, listType) {
            if (list.length === 0) {
                return;
            }
            
            const currencyLocale = 'ja-JP'; 
            const amountKey = 'jpy_amount'; 

            const groupedExpenses = list.reduce((groups, expense) => {
                const date = expense.date;
                if (!groups[date]) groups[date] = [];
                groups[date].push(expense);
                return groups;
            }, {});

            const sortedDates = Object.keys(groupedExpenses).sort().reverse();
            let htmlContent = '';

            sortedDates.forEach(date => {
                const dailyExpenses = groupedExpenses[date];

                const dailyTotal = dailyExpenses.reduce((sum, expense) => sum + expense[amountKey], 0);
                const dailyTotalFormatted = dailyTotal.toLocaleString(currencyLocale, { maximumFractionDigits: 0 });

                htmlContent += `
                    <div class="date-group">
                        <span>${date}</span> 
                        <span>åˆè¨ˆ: Â¥ ${dailyTotalFormatted}</span>
                    </div>
                `;
                
                htmlContent += `<ul class="expense-list">`;

                dailyExpenses.forEach(expense => {
                    const primaryAmount = expense[amountKey].toLocaleString(currencyLocale, { maximumFractionDigits: 0 });
                    
                    let descriptionHtml = expense.description;
                    let amountDisplay = `Â¥ ${primaryAmount}`;
                    
                    if (listType === 'CARD_JPY') {
                        const secondaryAmount = expense.twd_amount.toLocaleString('zh-TW', { maximumFractionDigits: 0 });
                        descriptionHtml += ` <span class="twd-in-list"> (NT$ ${secondaryAmount})</span>`;
                        descriptionHtml += ` <span class="card-name-in-list">(${expense.card_used})</span>`;
                    }
                    else if (listType === 'CASH_JPY') {
                        descriptionHtml += ` <span class="card-name-in-list">(ç¾é‡‘)</span>`;
                    }


                    htmlContent += `
                        <li>
                            <span class="item-description">${descriptionHtml}</span>
                            <span class="item-amount">${amountDisplay}</span>
                            <button class="delete-btn" onclick="deleteExpense(${expense.id})">x</button>
                        </li>
                    `;
                });

                htmlContent += `</ul>`;
            });
            
            container.innerHTML += htmlContent;
        }

        function saveAndRefresh() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(expenses));
            renderExpenses();
            calculateTotal();
        }
        
        // --- åˆå§‹åŒ– ---
        function init() {
            const storedExpenses = localStorage.getItem(STORAGE_KEY);
            if (storedExpenses) {
                let parsedExpenses = JSON.parse(storedExpenses);
                expenses = parsedExpenses.map(exp => {
                    // ç¢ºä¿èˆŠè³‡æ–™ä¹Ÿæœ‰ type æ¬„ä½ï¼Œä»¥åˆ©åˆ¤æ–·
                    if (!exp.type) { 
                         if (exp.twd_amount > 0) {
                            exp.type = 'CARD_JPY';
                         } else {
                            exp.type = 'CASH_JPY';
                         }
                    }
                    exp.card_used = exp.card_used || (exp.type === 'CASH_JPY' ? 'æ—¥å¹£ç¾é‡‘' : '');
                    return exp;
                });
            }
            
            initCardSelects();
            renderExpenses();
            calculateTotal();
            
            // ç¶å®šæ‰€æœ‰ç›¸é—œè¼¸å…¥æ¡†çš„ Enter éµ
            jpyAmountInput.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); 
                    if (jpyAmountInput.value.trim() && !twdCardInput.value.trim()) {
                        // ç¾é‡‘æ¨¡å¼ä¸‹ï¼Œç›´æ¥è¨˜éŒ„
                        addExpense(); 
                    } else {
                        // åˆ·å¡æ¨¡å¼ä¸‹ï¼Œåˆ‡æ›åˆ°å°å¹£é‡‘é¡
                        twdCardInput.focus(); 
                    }
                }
            });

            twdCardInput.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); 
                    twdCardSelect.focus();
                }
            });

            twdCardSelect.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); 
                    addExpense(); // åœ¨å¡åˆ¥é¸å–®æŒ‰ Enter è§¸ç™¼è¨˜éŒ„
                }
            });
        }
        
        window.onload = init; 
    </script>
</body>
</html>
